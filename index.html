<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merry Christmas ğŸ„</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Great+Vibes&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); /* æ·±è‰²èƒŒæ™¯ */
            color: #fff;
            font-family: "Montserrat", sans-serif;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        /* --- å…¨å±€åŠ¨æ€èƒŒæ™¯ç”»å¸ƒ --- */
        #bgCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -2; /* æ”¾åœ¨æœ€åº•å±‚ */
            pointer-events: none;
        }

        /* --- èƒŒæ™¯è£…é¥° (å·¨å¤§çš„æ¨¡ç³Šåœ£è¯æ ‘) --- */
        .bg-decoration {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Great Vibes', cursive;
            font-size: 45vw; /* è¶…å¤§ */
            opacity: 0.15; /* å¾ˆæ·¡ */
            filter: blur(8px);
            z-index: -1;
            pointer-events: none;
            color: #16a085;
        }

        .container {
            width: 90%;
            max-width: 600px;
            text-align: center;
            position: relative;
            z-index: 10; /* ä¿è¯å†…å®¹åœ¨èƒŒæ™¯ä¹‹ä¸Š */
            /* ç»™å®¹å™¨åŠ ä¸€ä¸ªåŠé€æ˜æ¯›ç»ç’ƒèƒŒæ™¯ï¼Œè®©æ–‡å­—æ›´æ¸…æ™° */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease;
        }

        h2 {
            font-family: 'Cinzel', serif; /* å¤å…¸å­—ä½“ */
            font-size: 1.4rem;
            margin-bottom: 35px;
            line-height: 1.6;
            /* é‡‘è‰²æ¸å˜æ–‡å­— */
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent; 
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* --- å°é¢é¡µç‰¹åˆ«æ ·å¼ --- */
        .cover-title {
            font-family: 'Great Vibes', cursive; /* æµªæ¼«æ‰‹å†™ä½“ */
            font-size: 4rem; /* æ”¾å¤§ */
            margin: 0 0 10px 0;
            color: #ff4757;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.6), 0 0 20px rgba(255, 71, 87, 0.4);
            animation: floatTitle 3s ease-in-out infinite;
        }
        .cover-subtitle {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 3px; /* å¢åŠ å­—é—´è·ï¼Œæ˜¾å¾—é«˜çº§ */
            text-transform: uppercase; /* å…¨å¤§å†™ */
            margin-bottom: 50px;
            opacity: 0.8;
            color: #dfe6e9;
        }
        /* --- æŒ‰é’®å‡çº§ï¼šæµå…‰æŒ‰é’® --- */
        .btn-start, .btn-confirm {
            font-family: 'Cinzel', serif;
            background: linear-gradient(90deg, #ff6b6b, #ff4757, #ff6b6b);
            background-size: 200%;
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4);
            transition: all 0.3s;
            text-transform: uppercase;
            font-weight: bold;
        }
        .btn-start:hover, .btn-confirm:hover {
            background-position: right center; /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯æµåŠ¨ */
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.6);
        }

        /* --- è¾“å…¥æ¡†ç¾åŒ– --- */
        input[type="text"], input[type="number"] {
            font-family: 'Montserrat', sans-serif;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
            color: #fff;
            font-size: 1.3rem;
            width: 70%;
            text-align: center;
            outline: none;
            transition: border-color 0.3s;
            margin-bottom: 45px;
        }
        input:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        /* --- å…³å¡æ§åˆ¶ --- */
        .level {
            display: none; /* é»˜è®¤éšè— */
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .level.active {
            display: block; /* æ¿€æ´»æ˜¾ç¤º */
        }


        /* --- å›¾ç‰‡ç½‘æ ¼ (é€šç”¨) --- */
        .grid-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .grid-options.level-2 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .grid-item {
            position: relative;
            cursor: pointer;
            border-radius: 15px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .grid-item:hover {
            transform: scale(1.05);
        }
        .grid-item img {
            width: 100%;
            aspect-ratio: 1 / 1; 
            object-fit: cover;
            display: block;
        }

        /* --- Level 2 æ’åºé¢˜ä¸“ç”¨ --- */
        .sort-item.selected { 
            border-color: #ff4757; 
            transform: scale(0.95); 
        }
        .sort-item.selected::after {
            content: ''; 
            position: absolute; 
            inset: 0; 
            background: rgba(255, 71, 87, 0.3);
        }
        .sort-badge {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background: #ff4757; 
            color: white; 
            width: 45px; 
            height: 45px;
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-family: 'Cinzel', serif; font-size: 1.5rem; 
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.6);
            opacity: 0; 
            transition: opacity 0.2s; z-index: 2;
        }
        .sort-item.selected .sort-badge { 
            opacity: 1; 
        }

        /* --- é€‰é¡¹å¡æ ·å¼ --- */
        .text-option, .img-text-option {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 18px; 
            margin: 12px 0;
            border-radius: 12px; 
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 1.1rem; 
            transition: all 0.2s;
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        .text-option:hover, .img-text-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateX(5px);
        }
        .img-text-option { 
            flex-direction: column; 
            padding: 0 0 15px 0; 
            overflow: hidden; 
        }
        .img-text-option img { 
            width: 100%; 
            aspect-ratio: 16/10; 
            object-fit: cover; 
        }
        .img-text-option span { 
            margin-top: 10px; 
            font-weight: 600; 
        }

        /* --- é”™è¯¯åé¦ˆ --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        .shake-screen .container { 
            animation: shake 0.4s ease-in-out; 
            border-color: #ff4757; 
        }
        #wrong-overlay {
            position: fixed; 
            inset: 0; 
            display: none; 
            justify-content: center; 
            align-items: center;
            z-index: 999; 
            pointer-events: none; 
            background: rgba(0,0,0,0.2);
        }
        #wrong-overlay span { 
            font-size: 8rem; 
            text-shadow: 0 0 30px #ff0000; 
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        /* --- æœ€ç»ˆæƒŠå–œé¡µé¢ --- */
        #final-page {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at bottom, #0f2027, #203a43, #2c5364);
            z-index: 1000;
            display: none;
        }
        canvas { 
            position: absolute; 
            inset: 0; 
            pointer-events: none;
        }
        
        .tree-container {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 2;
        }
        .christmas-tree {
            font-size: 120px;
            animation: breathe 3s infinite ease-in-out;
            cursor: pointer;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px gold); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 30px red); }
        }
        @keyframes textGlow { 
            from { 
                text-shadow: 0 0 10px rgba(255, 189, 89, 0.5); 
            } 
            to { 
                text-shadow: 0 0 30px rgba(255, 189, 89, 1); 
            }         
        }
        @keyframes fadeIn { 
            from { 
                opacity: 0; transform: translateY(10px); 
            } 
            to { 
                opacity: 1; transform: translateY(0); 
            } 
        }
        @keyframes popIn { 
            from { 
                transform: scale(0); opacity: 0; 
            } 
            to { 
                transform: scale(1); opacity: 1; 
            } 
        }
        .final-msg {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5rem; margin-top: 10px; color: #ffbd59;
            text-shadow: 0 0 15px rgba(255, 189, 89, 0.8);
            animation: textGlow 2s infinite alternate;
        }

        /* --- é‡ç©æŒ‰é’®æ ·å¼ --- */
        .btn-restart {
            margin-top: 30px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.6);
            padding: 8px 25px; border-radius: 20px; cursor: pointer;
            font-family: 'Montserrat', sans-serif; font-size: 0.8rem;
            transition: all 0.3s;
        }

        .btn-restart:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff; 
            color: #fff;
        }

        /* åŠ¨ç”» */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <audio id="bgm" loop preload="auto">
        <source src="music/bgm.mp3" type="audio/mpeg">
    </audio>

    <canvas id="bgCanvas"></canvas>
    <div class="bg-decoration">ğŸ„</div>

    <div id="wrong-overlay"><span>âŒ</span></div>

    <div class="container">
        
        <div id="level-0" class="level active">
            <div class="cover-title">ğŸ„ Merry Christmas! ğŸ„</div>
            <div class="cover-subtitle">ä¸€ä»½ä¸“å±äºä½ çš„è§£å¯†æŒ‘æˆ˜</div>
            <button class="btn-start" onclick="startGame()">å¼€å§‹æŒ‘æˆ˜</button>
        </div>

        <div id="level-1" class="level">
            <h2>Q1: æˆ‘ä»¬åœ¨ä¸€èµ·å·²ç»å¤šå°‘å¤©äº†ï¼Ÿ</h2>
            <input type="number" id="ans-1" placeholder="è¾“å…¥æ•°å­—">
            <br>
            <button class="btn-confirm" onclick="checkLevel1()">ç¡®è®¤</button>
        </div>

        <div id="level-2" class="level">
            <h2>Q2: æŒ‰æ—¶é—´é¡ºåºç‚¹å‡»è¿™äº›ç…§ç‰‡</h2>
            <div class="grid-options level-2" id="sort-grid">
                <div class="grid-item sort-item" onclick="toggleSort(0)">
                    <img src="images/sort1.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(1)">
                    <img src="images/sort2.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(2)">
                    <img src="images/sort3.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(3)">
                    <img src="images/sort4.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(4)">
                    <img src="images/sort5.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(5)">
                    <img src="images/sort6.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(6)">
                    <img src="images/sort7.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(7)">
                    <img src="images/sort8.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(8)">
                    <img src="images/sort9.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(9)">
                    <img src="images/sort10.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(10)">
                    <img src="images/sort11.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(11)">
                    <img src="images/sort12.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(12)">
                    <img src="images/sort13.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(13)">
                    <img src="images/sort14.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(14)">
                    <img src="images/sort15.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(15)">
                    <img src="images/sort16.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(16)">
                    <img src="images/sort17.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(17)">
                    <img src="images/sort18.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(18)">
                    <img src="images/sort19.jpg"> <div class="sort-badge"></div>
                </div>
                <div class="grid-item sort-item" onclick="toggleSort(19)">
                    <img src="images/sort20.jpg"> <div class="sort-badge"></div>
                </div>
            </div>
            <br>
            <button class="btn-confirm" onclick="checkLevel2()">ç¡®è®¤é¡ºåº</button>
        </div>

        <div id="level-3" class="level">
            <h2>Q3: å“ªè¾†è½¦æ˜¯æˆ‘æœ€å–œæ¬¢çš„ï¼Ÿ</h2>
            <div class="grid-options">
                <div class="grid-item" onclick="checkLevel3(false)"><img src="images/car_wrong1.jpg"></div>
                <div class="grid-item" onclick="checkLevel3(true)"><img src="images/car_right.jpg"></div> 
                <div class="grid-item" onclick="checkLevel3(false)"><img src="images/car_wrong2.jpg"></div>
                <div class="grid-item" onclick="checkLevel3(false)"><img src="images/car_wrong3.jpg"></div>
                <div class="grid-item" onclick="checkLevel3(false)"><img src="images/car_wrong4.jpg"></div>
                <div class="grid-item" onclick="checkLevel3(false)"><img src="images/car_wrong5.jpg"></div>
            </div>
        </div>

        <div id="level-4" class="level">
            <h2>Q4: å“ªå¹…ä¹¦æ³•æ˜¯æˆ‘æœ€å–œæ¬¢çš„ï¼Ÿ</h2>
            <div class="grid-options">
                <div class="grid-item" onclick="checkLevel4(false)"><img src="images/calligraphy1.jpg"></div>
                <div class="grid-item" onclick="checkLevel4(false)"><img src="images/calligraphy2.jpg"></div>
                <div class="grid-item" onclick="checkLevel4(false)"><img src="images/calligraphy3.jpg"></div>
                <div class="grid-item" onclick="checkLevel4(true)"><img src="images/calligraphy_right.jpg"></div>
                <div class="grid-item" onclick="checkLevel4(false)"><img src="images/calligraphy4.jpg"></div>
                <div class="grid-item" onclick="checkLevel4(false)"><img src="images/calligraphy5.jpg"></div>
            </div>
        </div>

        <div id="level-5" class="level">
            <h2>Q5: æˆ‘ä»¬çš„ä¸€æ¬¡æ€§èƒ¶ç‰‡ç›¸æœºè¿˜å‰©å‡ å¼ ï¼Ÿ</h2>
            <input type="number" id="ans-5" placeholder="è¾“å…¥æ•°å­—">
            <br>
            <button class="btn-confirm" onclick="checkLevel5()">ç¡®è®¤</button>
        </div>

        <div id="level-6" class="level">
            <h2>Q6: é’ç”˜å¤§ç¯çº¿æˆ‘ä»¬ç§Ÿçš„è½¦çš„è½¦ç‰Œæ˜¯ï¼Ÿ</h2>
            <div class="text-option" onclick="checkLevel6(false)">ç”˜AÂ·OEL21</div>
            <div class="text-option" onclick="checkLevel6(false)">é’AÂ·0FL21</div> 
            <div class="text-option" onclick="checkLevel6(true)">ç”˜AÂ·0EL21</div>
            <div class="text-option" onclick="checkLevel6(false)">ç”˜AÂ·OFL21</div>
            <div class="text-option" onclick="checkLevel6(false)">ç”˜AÂ·0EI21</div>
            <div class="text-option" onclick="checkLevel6(false)">é’AÂ·0FI21</div>
        </div>

        <div id="level-7" class="level">
            <h2>Q7: é‚£å¤©ä¸­ç½‘æ¯”èµ›ï¼Œæˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°è°ï¼Ÿ</h2>
            <div class="grid-options">
                <div class="img-text-option" onclick="checkLevel7(false)">
                    <img src="images/player1.jpg"><span>Mirra Andreeva</span>
                </div>
                <div class="img-text-option" onclick="checkLevel7(false)">
                    <img src="images/player2.jpg"><span>Karolina Muchova</span>
                </div>
                <div class="img-text-option" onclick="checkLevel7(true)"> 
                    <img src="images/player_missing.jpg"><span>Iga Swiatek</span>
                </div>
                <div class="img-text-option" onclick="checkLevel7(false)">
                    <img src="images/player3.jpg"><span>Priscilla Hon</span>
                </div>
                <div class="img-text-option" onclick="checkLevel7(false)">
                    <img src="images/player4.jpg"><span>Linda Noskova</span>
                </div>
                <div class="img-text-option" onclick="checkLevel7(false)">
                    <img src="images/player5.jpg"><span>Anastasia Potapova</span>
                </div>
            </div>
        </div>

    </div>

    <div id="final-gift-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 9999; background: black;">
        <iframe 
            id="gift-frame"
            src="" 
            frameborder="0" 
            allow="camera; microphone; autoplay" 
            style="width: 100%; height: 100%; border: none;">
        </iframe>
        
        <button onclick="location.reload()" style="position: absolute; bottom: 20px; left: 20px; color: gold; background: transparent; border: 1px solid gold; padding: 5px 10px; cursor: pointer; border-radius: 5px;">
            â†º Replay
        </button>
    </div>

    <script>
        // ================= é…ç½®åŒºåŸŸ (è¯·åœ¨è¿™é‡Œä¿®æ”¹ç­”æ¡ˆ) =================
        const ANSWERS = {
            q1_days: "467",       // Q1: åœ¨ä¸€èµ·çš„å¤©æ•°
            q2_order: [0, 18, 6, 5, 11, 8, 7, 17, 13, 12, 19, 3, 16, 9, 10, 15, 4, 1, 2, 14], // Q2: æ­£ç¡®çš„å›¾ç‰‡ç‚¹å‡»ç´¢å¼•é¡ºåº (0ä»£è¡¨ç¬¬ä¸€å¼ å›¾, 1ä»£è¡¨ç¬¬äºŒå¼ ...)
            q5_film: "8",         // Q5: å‰©ä½™èƒ¶ç‰‡æ•°
        };
        // ============================================================

        let currentLevel = 0;

        // --- å…¨å±€èƒŒæ™¯ç²’å­ç‰¹æ•ˆ (Bling Bling) ---
        function initBgParticles() {
            const canvas = document.getElementById('bgCanvas');
            const ctx = canvas.getContext('2d');
            let width = canvas.width = window.innerWidth;
            let height = canvas.height = window.innerHeight;

            let particles = [];
            for(let i = 0; i < 100; i++) { // ç²’å­æ•°é‡
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    r: Math.random() * 2 + 0.5, // åŠå¾„
                    d: Math.random() * 1 + 0.2, // ä¸‹è½é€Ÿåº¦
                    a: Math.random() * 0.5 + 0.1 // é€æ˜åº¦
                })
            }

            function draw() {
                ctx.clearRect(0, 0, width, height);
                ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                ctx.beginPath();
                for(let i = 0; i < particles.length; i++) {
                    let p = particles[i];
                    ctx.moveTo(p.x, p.y);
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2, true);
                }
                ctx.fill();
                update();
            }

            function update() {
                for(let i = 0; i < particles.length; i++) {
                    let p = particles[i];
                    p.y += p.d;
                    // é£˜åŠ¨æ•ˆæœ
                    p.x += Math.sin(p.y * 0.01) * 0.2;
                    if(p.y > height) {
                        particles[i] = {x: Math.random()*width, y: -10, r:p.r, d:p.d, a:p.a};
                    }
                }
            }
            
            function animate() { draw(); requestAnimationFrame(animate); }
            animate();
            window.addEventListener('resize', () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            });
        }
        initBgParticles(); // ç«‹å³å¯åŠ¨èƒŒæ™¯ç‰¹æ•ˆ

        // --- æ¸¸æˆæ§åˆ¶ ---
        function startGame() { 
            const bgm = document.getElementById('bgm');
            if (bgm) {
                bgm.volume = 0.5; // éŸ³é‡è®¾ç½® 0.5 (åŠéŸ³é‡)ï¼Œé˜²æ­¢æŠŠå¥³æœ‹å‹å“ä¸€è·³
                bgm.play().catch(error => {
                    console.log("æµè§ˆå™¨é˜»æ­¢äº†è‡ªåŠ¨æ’­æ”¾ï¼Œç”¨æˆ·éœ€è¦æ›´å¤šäº¤äº’", error);
                });
            }
            nextLevel(); 
        }
        
        // å·¥å…·å‡½æ•°ï¼šåˆ‡æ¢å…³å¡
        function nextLevel() {
            document.getElementById(`level-${currentLevel}`).classList.remove('active');
            currentLevel++;
            if (currentLevel <= 7) {
                document.getElementById(`level-${currentLevel}`).classList.add('active');
            } else {
                showFinalSurprise();
            }
        }

        // å·¥å…·å‡½æ•°ï¼šé”™è¯¯åé¦ˆ (æŠ–åŠ¨ + çº¢å‰)
        function triggerError() {
            // 1. å±å¹•æŠ–åŠ¨
            document.body.classList.add('shake-screen');
            setTimeout(() => document.body.classList.remove('shake-screen'), 500);

            // 2. æ˜¾ç¤ºçº¢å‰
            const overlay = document.getElementById('wrong-overlay');
            overlay.style.display = 'flex';
            setTimeout(() => overlay.style.display = 'none', 800);
            
            // 3. (å¯é€‰) å¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªé”™è¯¯çš„éŸ³æ•ˆ
        }

        // --- Level 1 é€»è¾‘ ---
        function checkLevel1() {
            const val = document.getElementById('ans-1').value.trim();
            if (val === ANSWERS.q1_days) nextLevel();
            else triggerError();
        }

        // --- Level 2 é€»è¾‘ (å¤æ‚çš„æ’åº) ---
        let userSequence = []; // å­˜å‚¨ç”¨æˆ·ç‚¹å‡»çš„ç´¢å¼•

        function toggleSort(index) {
            const items = document.querySelectorAll('.sort-item');
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»é€‰è¿‡
            const existingPos = userSequence.indexOf(index);
            
            if (existingPos !== -1) {
                // å¦‚æœå·²ç»é€‰è¿‡ï¼Œåˆ™å–æ¶ˆé€‰æ‹© (ç§»é™¤)
                userSequence.splice(existingPos, 1);
            } else {
                // æ²¡é€‰è¿‡ï¼Œæ·»åŠ åˆ°æœ«å°¾
                userSequence.push(index);
            }

            // é‡æ–°æ¸²æŸ“UI (æ ¸å¿ƒé€»è¾‘ï¼šæ ¹æ®æ•°ç»„é¡ºåºç»™ Badge èµ‹å€¼)
            items.forEach((item, idx) => {
                // æ¸…é™¤çŠ¶æ€
                item.classList.remove('selected');
                item.querySelector('.sort-badge').innerText = '';
            });

            // åŠ ä¸ŠçŠ¶æ€
            userSequence.forEach((imgIndex, orderIndex) => {
                const targetItem = items[imgIndex];
                targetItem.classList.add('selected');
                targetItem.querySelector('.sort-badge').innerText = orderIndex + 1;
            });
        }

        function checkLevel2() {
            // æ£€æŸ¥é•¿åº¦
            if (userSequence.length !== ANSWERS.q2_order.length) {
                triggerError();
                return;
            }
            // æ£€æŸ¥æ¯ä¸€é¡¹
            const isCorrect = userSequence.every((val, index) => val === ANSWERS.q2_order[index]);
            
            if (isCorrect) nextLevel();
            else {
                triggerError();
                // å¯ä»¥åœ¨è¿™é‡Œæ¸…ç©ºé€‰æ‹©ï¼Œæˆ–è€…ä¿ç•™è®©ç”¨æˆ·ä¿®æ”¹ï¼Œè¿™é‡Œé€‰æ‹©ä¿ç•™è®©ç”¨æˆ·ä¿®æ”¹
            }
        }

        // --- Level 3, 4, 6, 7 é€šç”¨é€»è¾‘ (ç‚¹å‡»å³åˆ¤æ–­) ---
        function checkLevel3(isRight) { isRight ? nextLevel() : triggerError(); }
        function checkLevel4(isRight) { isRight ? nextLevel() : triggerError(); }
        function checkLevel6(isRight) { isRight ? nextLevel() : triggerError(); }
        function checkLevel7(isRight) { isRight ? nextLevel() : triggerError(); }

        // --- Level 5 é€»è¾‘ ---
        function checkLevel5() {
            const val = document.getElementById('ans-5').value.trim();
            if (val === ANSWERS.q5_film) nextLevel();
            else triggerError();
        }

        // ================= æœ€ç»ˆæƒŠå–œ =================
        function showFinalSurprise() {
            const bgm = document.getElementById('bgm');
            if (bgm) {
                bgm.pause(); // æš‚åœ
                bgm.currentTime = 0; // (å¯é€‰) è¿›åº¦å½’é›¶
            }
            // 1. éšè—åŸæ¥çš„æ¸¸æˆç•Œé¢
            document.querySelector('.container').style.display = 'none';
            document.getElementById('bgCanvas').style.display = 'none';
            document.querySelector('.bg-decoration').style.display = 'none';

            // 2. æ˜¾ç¤ºç¤¼ç‰©å®¹å™¨
            const giftContainer = document.getElementById('final-gift-container');
            giftContainer.style.display = 'block';

            // 3. æ ¸å¿ƒä¸€æ­¥ï¼šåŠ è½½ç¤¼ç‰©é¡µé¢ï¼
            // è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šæ¸¸æˆåˆšå¼€å§‹æ—¶ä¸åŠ è½½ 3Dï¼Œé€šå…³é‚£ä¸€åˆ»æ‰å¼€å§‹åŠ è½½ï¼Œä¸ä»…çœæµé‡ï¼Œè¿˜èƒ½åˆ¶é€ â€œå¼€å¯â€çš„æ„Ÿè§‰
            const giftFrame = document.getElementById('gift-frame');
            giftFrame.src = "./final_gift/index.html";
        }

        // ç®€æ˜“çƒŸèŠ±ç²’å­ç³»ç»Ÿ
        function startFireworks() {
            const canvas = document.getElementById('fireworksCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            let particles = [];
            
            class Particle {
                constructor(x, y, color) {
                    this.x = x; this.y = y; this.color = color;
                    this.velocity = { x: (Math.random() - 0.5) * 8, y: (Math.random() - 0.5) * 8 };
                    this.alpha = 1; this.friction = 0.96;
                }
                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2, false);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                update() {
                    this.velocity.x *= this.friction;
                    this.velocity.y *= this.friction;
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.alpha -= 0.01;
                }
            }

            function createFirework(x, y) {
                const color = `hsl(${Math.random() * 360}, 50%, 50%)`;
                for (let i = 0; i < 30; i++) {
                    particles.push(new Particle(x, y, color));
                }
            }

            function animate() {
                requestAnimationFrame(animate);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; // æ‹–å°¾æ•ˆæœ
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach((particle, index) => {
                    if (particle.alpha > 0) {
                        particle.update();
                        particle.draw();
                    } else {
                        particles.splice(index, 1);
                    }
                });

                // éšæœºè‡ªåŠ¨å‘å°„
                if (Math.random() < 0.05) {
                    createFirework(Math.random() * canvas.width, Math.random() * canvas.height * 0.5);
                }
            }
            animate();
            
            // ç‚¹å‡»å±å¹•ä¹Ÿä¼šå‘å°„
            canvas.addEventListener('click', (e) => {
                createFirework(e.clientX, e.clientY);
            });
        }

        // --- å†ç©ä¸€æ¬¡çš„åŠŸèƒ½ ---
        function replayGame() {
            // ç›´æ¥åˆ·æ–°é¡µé¢ï¼Œè¿™æ˜¯æœ€ç¨³å¦¥çš„é‡ç½®æ–¹å¼
            // å®ƒä¼šæ¸…ç©ºæ‰€æœ‰è¾“å…¥ã€é‡ç½®éŸ³ä¹ã€é‡ç½®æ’åºé¢˜çš„çŠ¶æ€
            location.reload(); 
        }


        // ============================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ æµ‹è¯•ä¸“ç”¨ï¼šä¸Šå¸æ¨¡å¼èœå• (å‘å¸ƒå‰è¯·åˆ é™¤) ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ============================================
        (function debugMode() {
            // 1. åˆ›å»ºæ‚¬æµ®å®¹å™¨
            const debugDiv = document.createElement('div');
            debugDiv.style.cssText = `
                position: fixed; 
                top: 10px; 
                right: 10px; 
                z-index: 10000; 
                background: rgba(0, 0, 0, 0.8); 
                padding: 10px; 
                border-radius: 8px; 
                box-shadow: 0 0 10px rgba(0,0,0,0.5);
                font-family: sans-serif;
            `;

            // 2. åˆ›å»ºä¸‹æ‹‰èœå•
            const select = document.createElement('select');
            select.style.cssText = "padding: 5px; font-size: 14px; border-radius: 4px;";
            
            // å®šä¹‰æ‰€æœ‰å…³å¡
            const levels = [
                { val: 0, text: "Level 0: å°é¢" },
                { val: 1, text: "Level 1: å¤©æ•°" },
                { val: 2, text: "Level 2: ç…§ç‰‡æ’åº" },
                { val: 3, text: "Level 3: é€‰è½¦" },
                { val: 4, text: "Level 4: ä¹¦æ³•" },
                { val: 5, text: "Level 5: èƒ¶ç‰‡" },
                { val: 6, text: "Level 6: è½¦ç‰Œ" },
                { val: 7, text: "Level 7: ä¸­ç½‘" },
                { val: 99, text: "ğŸ‰ æœ€ç»ˆæƒŠå–œé¡µ" }
            ];

            // ç”Ÿæˆé€‰é¡¹
            levels.forEach(lvl => {
                const opt = document.createElement('option');
                opt.value = lvl.val;
                opt.innerText = lvl.text;
                select.appendChild(opt);
            });

            // 3. ç»‘å®šè·³è½¬é€»è¾‘
            select.onchange = function() {
                const target = parseInt(this.value);
                
                // é‡ç½®çŠ¶æ€
                document.getElementById('final-gift-container').style.display = 'none'; // è—èµ·çƒŸèŠ±é¡µ
                document.querySelector('.container').style.display = 'block'; // æ˜¾ç¤ºä¸»å®¹å™¨
                
                // éšè—æ‰€æœ‰å…³å¡
                for (let i = 0; i <= 7; i++) {
                    const el = document.getElementById(`level-${i}`);
                    if (el) el.classList.remove('active');
                }

                if (target === 99) {
                    // å¦‚æœé€‰çš„æ˜¯æœ€ç»ˆé¡µ
                    showFinalSurprise();
                } else {
                    // å¦‚æœé€‰çš„æ˜¯æ™®é€šå…³å¡
                    currentLevel = target; // æ›´æ–°å…¨å±€å˜é‡ï¼Œä¿è¯"ä¸‹ä¸€å…³"é€»è¾‘æ­£ç¡®
                    document.getElementById(`level-${target}`).classList.add('active');
                }
            };

            // 4. æ·»åŠ æ ‡ç­¾
            const label = document.createElement('div');
            label.innerText = "ğŸ”§ æµ‹è¯•è·³è½¬:";
            label.style.cssText = "color: #fff; margin-bottom: 5px; font-size: 12px; font-weight: bold;";

            // 5. ç»„è£…å¹¶æ’å…¥é¡µé¢
            debugDiv.appendChild(label);
            debugDiv.appendChild(select);
            document.body.appendChild(debugDiv);

        })();
        // ============================================
        // ğŸ‘†ğŸ‘†ğŸ‘† æµ‹è¯•ä¸“ç”¨ä»£ç ç»“æŸ ğŸ‘†ğŸ‘†ğŸ‘†
        // ============================================
    </script>

    
</body>
</html>